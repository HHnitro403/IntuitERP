<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="IntuitERP.Viwes.CadastrodeVenda"
             Title="CadastrodeVenda">
    <!-- Main Grid for the page layout -->
    <Grid RowSpacing="0" Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Form Content -->
            <RowDefinition Height="Auto"/>
            <!-- Footer with Buttons -->
        </Grid.RowDefinitions>

        <!-- Top header -->
        <Grid Grid.Row="0" BackgroundColor="{AppThemeBinding Light=#FFE4C4, Dark=#1A1C20}" Padding="10,15">
            <Label Text="Nova Venda" TextColor="White" FontSize="22" FontAttributes="Bold" HorizontalOptions="Center"/>
        </Grid>

        <!-- Scrollable Form Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- Seção de Informações da Venda Principal -->
                <Frame BorderColor="{AppThemeBinding Light=#CCCCCC, Dark=#555555}" CornerRadius="8" Padding="15">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Detalhes da Venda" FontSize="18" FontAttributes="Bold"/>

                        <!-- Data da Venda -->
                        <Label Text="Data da Venda:" FontSize="16"/>
                        <DatePicker x:Name="DataVendaPicker" FontSize="16" Format="dd/MM/yyyy"/>

                        <!-- Hora da Venda -->
                        <Label Text="Hora da Venda:" FontSize="16"/>
                        <TimePicker x:Name="HoraVendaPicker" FontSize="16" Format="HH:mm"/>

                        <!-- Código do Cliente (CodCliente) -->
                        <Label Text="Cliente:" FontSize="16"/>
                        <Picker x:Name="ClientePicker" Title="Selecione o Cliente" FontSize="16">
                            <!-- Items would be populated from your 'cliente' table in C# -->
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>Cliente Alpha (Cód: 1)</x:String>
                                    <x:String>Cliente Beta (Cód: 2)</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>

                        <!-- Código do Vendedor (CodVendedor) -->
                        <Label Text="Vendedor:" FontSize="16"/>
                        <Picker x:Name="VendedorPicker" Title="Selecione o Vendedor" FontSize="16">
                            <!-- Items would be populated from your 'vendedor' table in C# -->
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>Vendedor 1 (Cód: 101)</x:String>
                                    <x:String>Vendedor 2 (Cód: 102)</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>

                        <!-- Desconto Geral da Venda -->
                        <Label Text="Desconto Geral (R$):" FontSize="16"/>
                        <Entry x:Name="DescontoVendaEntry" Placeholder="0.00" Keyboard="Numeric" FontSize="16"/>

                        <!-- Observações (OBS) -->
                        <Label Text="Observações:" FontSize="16"/>
                        <Editor x:Name="ObservacoesEditor" Placeholder="Digite observações sobre a venda" HeightRequest="100" AutoSize="TextChanges" FontSize="16"/>

                        <!-- Forma de Pagamento -->
                        <Label Text="Forma de Pagamento:" FontSize="16"/>
                        <Picker x:Name="FormaPagamentoPicker" Title="Selecione a forma de pagamento" FontSize="16">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>Dinheiro</x:String>
                                    <x:String>Cartão de Crédito</x:String>
                                    <x:String>Cartão de Débito</x:String>
                                    <x:String>PIX</x:String>
                                    <x:String>Boleto Bancário</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>

                        <!-- Status da Venda -->
                        <Label Text="Status da Venda:" FontSize="16"/>
                        <Picker x:Name="StatusVendaPicker" Title="Selecione o status" FontSize="16">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>Orçamento</x:String>
                                    <x:String>Pendente</x:String>
                                    <x:String>Faturada</x:String>
                                    <x:String>Cancelada</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>

                        <!-- Valor Total da Venda (Calculado) -->
                        <Label Text="Valor Total da Venda (R$):" FontSize="16" FontAttributes="Bold"/>
                        <Label x:Name="ValorTotalVendaLabel" Text="0.00" FontSize="20" FontAttributes="Bold" TextColor="{AppThemeBinding Light=DarkGreen, Dark=LightGreen}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Seção de Itens da Venda -->
                <Frame BorderColor="{AppThemeBinding Light=#CCCCCC, Dark=#555555}" CornerRadius="8" Padding="15">
                    <VerticalStackLayout Spacing="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Text="Itens da Venda" FontSize="18" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Button Grid.Column="1" x:Name="AdicionarItemVendaButton" Text="Adicionar Item" BackgroundColor="DodgerBlue" TextColor="White" CornerRadius="5" Padding="10,5"/>
                        </Grid>

                        <!-- Lista de Itens (CollectionView) -->
                        <!-- In a real app, ItemsSource would be bound to an ObservableCollection in C# -->
                        <CollectionView x:Name="ItensVendaCollectionView" HeightRequest="200" EmptyView="Nenhum item adicionado.">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame BorderColor="{AppThemeBinding Light=#DDDDDD, Dark=#444444}" Padding="10" Margin="0,5" CornerRadius="5">
                                        <Grid RowSpacing="5" ColumnSpacing="10">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Produto (CodProduto) -->
                                            <Picker Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Title="Selecione o Produto" FontSize="14">
                                                <!-- ItemsSource would be bound to a list of products in C# -->
                                                <!-- Example placeholder items: -->
                                                <Picker.ItemsSource>
                                                    <x:Array Type="{x:Type x:String}">
                                                        <x:String>Produto X (Cód: 10)</x:String>
                                                        <x:String>Produto Y (Cód: 20)</x:String>
                                                        <x:String>Produto Z (Cód: 30)</x:String>
                                                    </x:Array>
                                                </Picker.ItemsSource>
                                                <!-- ItemDisplayBinding and SelectedItem would be bound in C# -->
                                            </Picker>

                                            <!-- Descrição (ReadOnly, ideally auto-filled from Produto selection) -->
                                            <!-- <Label Grid.Row="0" Grid.Column="1" Text="{Binding DescricaoProduto}" FontSize="14" VerticalOptions="Center"/> -->

                                            <!-- Quantidade -->
                                            <Entry Grid.Row="1" Grid.Column="0" Placeholder="Qtde." Keyboard="Numeric" FontSize="14" Text="{Binding Quantidade}"/>

                                            <!-- Valor Unitário (ReadOnly, ideally auto-filled from Produto selection) -->
                                            <Entry Grid.Row="1" Grid.Column="1" Placeholder="Val. Unit." Keyboard="Numeric" FontSize="14" Text="{Binding ValorUnitario}" IsEnabled="False"/>

                                            <!-- Desconto do Item -->
                                            <Entry Grid.Row="2" Grid.Column="0" Placeholder="Desc. Item (R$)" Keyboard="Numeric" FontSize="14" Text="{Binding DescontoItem}"/>

                                            <!-- Valor Total do Item (Calculado) -->
                                            <Label Grid.Row="2" Grid.Column="1" FontSize="14" FontAttributes="Bold" VerticalOptions="Center">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="Total: R$ "/>
                                                        <Span Text="{Binding ValorTotalItem, StringFormat='{0:N2}'}"/>
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>

                                            <!-- Botão Remover Item -->
                                            <Button Grid.Row="0" Grid.RowSpan="3" Grid.Column="2" Text="Remover" BackgroundColor="IndianRed" TextColor="White" FontSize="12" CornerRadius="5" VerticalOptions="Center"
                                                    Command="{Binding Source={x:Reference ItensVendaCollectionView}, Path=BindingContext.RemoverItemVendaCommand}" CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer with Action Buttons -->
        <Grid Grid.Row="2" Padding="20" ColumnSpacing="10" BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#2C2C2C}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="SalvarVendaButton" Grid.Column="0" Text="Salvar Venda" BackgroundColor="ForestGreen" TextColor="White" FontSize="16" CornerRadius="8"/>
            <Button x:Name="CancelarVendaButton" Grid.Column="1" Text="Cancelar" BackgroundColor="DarkRed" TextColor="White" FontSize="16" CornerRadius="8"/>
            <!-- Add Clicked event handlers in C# for functionality -->
        </Grid>
    </Grid>
</ContentPage>